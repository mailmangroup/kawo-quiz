var data = {
	questions: [{"question":{"en":"On average, what time are people most active on WeChat?","zh":"一般来说，用户一天内使用微信最多的是几点？"},"choices":[{"en":"22:00","zh":""},{"en":"12:00","zh":""},{"en":"16:30","zh":""},{"en":"9:45","zh":""}],"answer": "A","response":{"en":"On average, netizens were most active on WeChat at 22:00 in 2015.","zh":"根据2015年的统计，微信用户最爱在晚上10点左右使用该软件。"}},{"question":{"en":"Where do 80% of WeChat users find WeChat articles?","zh":"80%的微信用户是怎么寻找微信公众号的文章的？"},"choices":[{"en":"WeChat Broadcast Messages","zh":"微信公众号推送"},{"en":"WeChat Moments","zh":"微信朋友圈"},{"en":"WeChat Shake it off","zh":"摇一摇"},{"en":"WeChat Walkie Talkie","zh":"微信即时对讲聊天"}],"answer": "B","response":{"en":"80% of WeChat users find WeChat articles on WeChat Moments.","zh":"80%的微信用户通过微信朋友圈看到微信文章。"}},{"question":{"en":"What are the top 3 categories of articles on WeChat by number of readers and sharing?","zh":"哪三种类型的文章在微信阅读和分享量最多？"},"choices":[{"en":"Pathology, Healthcare, and domestic travel ","zh":"养生，健康，国内旅游"},{"en":"Emotional life, company management, and cooking","zh":"情感生活，公司管理，烹饪"},{"en":"Emotional life, healthcare, and politics & law","zh":"情感生活，健康，法律法规"},{"en":"Domestic Travel, emotional life, politics & law news","zh":"国内旅游，情感生活，法律法规"}],"answer": "C","response":{"en":"The top 3 categories of articles on WeChat by number of readers and sharing are Emotional Life, Healthcare, and Politics & Law","zh":"情感生活，健康以及法律法规类的文章是微信中阅读和分享量最高的三种文章。"}},{"question":{"en":"How many e-commerce vendors are connected through the WeChat platform?","zh":"大约一共有多少微信公众号？"},"choices":[{"en":"8,000-10,000","zh":""},{"en":"6,000-8,000","zh":""},{"en":"4,000-6,000","zh":""},{"en":"2,000-4,000","zh":""}],"answer": "D","response":{"en":"2,433 vendors are connected through the WeChat platform. 18,882 vendors are still awaiting approval.","zh":"在微信平台中一共有2645个公众号。"}},{"question":{"en":"How much money can you transfer each month before WeChat Payment charges a transaction fee?","zh":"每月微信支付可以允许用户免手续费转账多少钱？"},"choices":[{"en":"20,000 RMB","zh":""},{"en":"8,000 RMB","zh":""},{"en":"30,000RMB","zh":""},{"en":"15,000RMB","zh":""}],"answer": "A","response":{"en":"You can transfer up to 20,000 RMB each month before WeChat Payment charges a transaction fee.","zh":"每月微信支付可以允许用户免手续费转账20000元。"}},{"question":{"en":"Tencent invested in what movie that ended up being the highest-grossing Chinese movie in history?","zh":"腾讯投资于哪个电影，并成为中国历史票房最高的电影？"},"choices":[{"en":"Lost in Thailand","zh":"泰囧"},{"en":"Goodbye Mr. Loser","zh":"夏洛特烦恼"},{"en":"Monster Hunt","zh":"捉妖记"},{"en":"Furious 7","zh":"速度与激情 7"}],"answer": "C","response":{"en":"Tencent invested in the domestic film Monster Hunt, which has grossed over $260 million in China.","zh":"腾讯投资在混合真人和动画国产电影《捉妖记》，它在中国的票房收入超过2亿6000万美元。"}},{"question":{"en":"How many WeChat articles does the average WeChat user read per day?","zh":"每位用户每天会阅读多少篇公众号文章？"},"choices":[{"en":"2.74","zh":""},{"en":"5.86","zh":""},{"en":"7.32","zh":""},{"en":"10.48","zh":""}],"answer": "B","response":{"en":"The average WeChat user reads 5.86 WeChat articles daily.","zh":"每位微信用户每天平均阅读5.86篇微信文章。"}},{"question":{"en":"How long does the average Chinese adult read on WeChat per day?","zh":"每位用户每天会花多少时间在阅读微信文章？"},"choices":[{"en":"20 minutes / 20 分钟","zh":""},{"en":"40 minutes / 40 分钟","zh":""},{"en":"80 minutes / 80 分钟","zh":""},{"en":"160 minutes / 160 分钟","zh":""}],"answer": "C","response":{"en":"The average Chinese adult reads for 80 minutes on WeChat per day.","zh":"每位微信用户每天平均阅读微信文章的时间为80分钟。"}},{"question":{"en":"Which Chinese platform is the equivalent to Vine?","zh":"哪个中国的平台更类似于Vine？"},"choices":[{"en":"Weishi/Miaopai","zh":"秒拍"},{"en":"Meitu","zh":"美图秀秀"},{"en":"Bilibili","zh":"哔哩哔哩弹幕视频网"},{"en":"Xiaokaxiu","zh":"小咖秀"}],"answer": "A","response":{"en":"Weishi/Miaopai are often considered the 'Chinese Vines'.","zh":"微视/秒拍被认为是中国的Vine。"}},{"question":{"en":"Which apps were affected by the XcodeGhost hack in the apple store this year?","zh":"哪些软件被 XcodeGhost 在苹果软件商城被黑客影响到？"},"choices":[{"en":"WeChat, Didi Kuaidi, NetEase","zh":"微信，快的打车，网易"},{"en":"Whatsapp, QQ","zh":""},{"en":"Baidu Map, Youku, Taobao","zh":"百度地图，优酷，淘宝"},{"en":"Tencent Video, T-Mall","zh":"腾讯视频，天猫"}],"answer": "A","response":{"en":"WeChat, Didi Kuaidi, and NetEase were all affected by the XcodeGhost hack in the Apple app store in 2015.","zh":"微信，快的打车，网易全部在2015年受到了 XcodeGhost 在苹果软件商场的黑客攻击。"}},{"question":{"en":"Which Chinese tech company invested $50 million in Kik Messenger? ","zh":"中国的哪家科技公司在Kik上投资了5000万美金？"},"choices":[{"en":"Tencent","zh":"腾讯"},{"en":"Jiayuan","zh":"家园"},{"en":"Sina Corporation ","zh":"新浪"},{"en":"Xiaomi","zh":"小米"}],"answer": "A","response":{"en":"In Aug. 2015, Chinese tech-giant Tencent invested $50 million in Kik Messenger valuing Kik at $1 billion.","zh":"2015年8月，腾讯投资5千万美金在估值10亿的Kik中。"}},{"question":{"en":"Which of these apps does not exist?","zh":"哪个手机软件已经不存在了？"},"choices":[{"en":"Didi DaRen (a service to have someone beaten)","zh":"滴滴打人"},{"en":"Dafeiji (a game that chose the name of slang for male masturbation)","zh":"打飞机"},{"en":"Didi","zh":"滴滴"},{"en":"Gou rou haochi (an app to find dog meat restaurants nearby)","zh":"狗肉好吃"}],"answer": "D","response":{"en":"Gou rou haochi (an app used to find dog meat restaurants nearby) is NOT an actual app.","zh":"狗肉好吃（一款找吃狗肉餐厅的软件）已经消失了。"}},{"question":{"en":"What is the most popular cab hailing service in China? ","zh":"以下哪个叫车服务在中国最流行？"},"choices":[{"en":"Uber ","zh":"优步"},{"en":"Didi DaChe","zh":"滴滴打车"},{"en":"Didi KuaiDi","zh":"快的打车"},{"en":"Hitchhiking ","zh":"搭便车"}],"answer": "B","response":{"en":"The most popular cab hailing service in China is Didi DaChe.","zh":"滴滴打车是在中国最流行的打车软件。"}},{"question":{"en":"What percentage of the $9.34 billion in Single's Day sales were made via Mobile?","zh":"双十一购物节产生的93.4亿销售额中有百分之多少是通过手机付款的？"},"choices":[{"en":"39.40%","zh":""},{"en":"59.30%","zh":""},{"en":"42.60%","zh":""},{"en":"76.20%","zh":""}],"answer": "C","response":{"en":"A whopping 42.6% of Single's Day's $9.34 billion in sales were made via mobile.","zh":"双十一产生的93.4亿美金销售额中有42.6％的付款是通过手机完成的。"}},{"question":{"en":"With which Chinese company did the NBA sign a 5 year deal?","zh":"中国哪个公司和NBA签署了5年的合作合同？"},"choices":[{"en":"Alibaba","zh":"阿里巴巴"},{"en":"Tencent","zh":"腾讯"},{"en":"Jiayuan ","zh":"家园"},{"en":"Sina Corporation","zh":"新浪"}],"answer": "B","response":{"en":"In Jan. 2015, internet giant Tencent and the NBA signed a 5-yr deal valued at $700 million making Tencent the exclusive digital partner of the NBA. ","zh":"2015年1月，网络界的巨头腾讯和NBA签署了5年7亿美金的合同，腾讯也成为NBA的独家数字合作伙伴。"}},{"question":{"en":"How many acquisitions has Alibaba made since 2014? ","zh":"阿里巴巴从2014年以来一共收购了多少公司？"},"choices":[{"en":"35","zh":""},{"en":"47","zh":""},{"en":"67","zh":""},{"en":"OVER 9,000 / 大于 9,000","zh":""}],"answer": "B","response":{"en":"Since 2014, Alibaba has made over 47 acquisitons spending $13.4 billion in the process.","zh":"从2014年，阿里巴巴花费134亿收购47家公司。"}},{"question":{"en":"Which Premier League team signed an agreement with PPTV  to launch official branded TV's & programming?","zh":"哪个英超球队和PPTV签署官方电视合作合同？"},"choices":[{"en":"Manchester United FC","zh":"曼联足球俱乐部"},{"en":"Chelsea FC","zh":"切尔西足球俱乐部"},{"en":"Liverpool FC","zh":"利物浦足球俱乐部"},{"en":"Arsenal FC","zh":"阿森纳足球俱乐部"}],"answer": "C","response":{"en":"In Nov. 2015, Mailman Group brokered an agreement between Liverpool FC and PPTV to launch official branded TV's & programming.","zh":"2015年11月，在上海邮人商务咨询有限公司的牵线和帮助下，利物浦与PPTV达成了一份官方电视的合作协议。"}},{"question":{"en":"How many Youku users spend an average of an hour or more a day on Youku?","zh":"多少用户每天会花一个小时以上的时间通过优酷看视频？"},"choices":[{"en":"40 million / 4,000 万","zh":""},{"en":"60 million / 6,000 万","zh":""},{"en":"80 million / 8,000 万","zh":""},{"en":"100 million / 1 亿","zh":""}],"answer": "A","response":{"en":"It's reported that 40 million netizens spend an average of an hour or more per day on Youku.","zh":"据报道，每天会有4000万的网络用户会花一个小时以上时间在看优酷视频上。"}},{"question":{"en":"Tencent signed deals with Disney and 20th Century Fox to bring which science fiction series to China?","zh":"腾讯和迪士尼和20世纪福克斯公司签约将哪个科幻电影系列带到了中国？"},"choices":[{"en":"Star Wars","zh":"星球大战"},{"en":"Tron","zh":"创：战斗记"},{"en":"Monster's Inc. ","zh":"怪物的公司"},{"en":"Tomorrowland ","zh":"明日世界"}],"answer": "A","response":{"en":"In Sep. 2015, Tencent signed deals with Disney and 20th Century Fox to be the exclusive online provider of Star Wars in mainland China.","zh":"2015年9月，腾讯和迪士尼，20世纪福克斯签署合同，成为中国地区《星球大战》独家TVOD和SVOD在线合作伙伴。"}},{"question":{"en":"How many of China's 1.37 billion citizens are active social media users?","zh":"13亿中国人口中有多少社交媒体的用户？"},"choices":[{"en":"847 million / 8.47 亿","zh":""},{"en":"792 million / 7.92 亿","zh":""},{"en":"2.999 billion / 29.99 亿","zh":""},{"en":"659 million / 6.59 亿","zh":""}],"answer": "D","response":{"en":"China sports a staggering 659 million active social media users. That's more than twice the population of the USA!","zh":"中国的活跃社交媒体用户有6.59 亿，是美国的用户的两倍"}},]
}

var images = {
	correct: [
		'icon_007.gif',
		'icon_001.gif',
		'correct_01.gif',
		'correct_02.gif',
		'correct_03.gif',
		'correct_04.gif',
		'correct_05.gif',
		'correct_06.gif',
		'correct_07.gif',
		'correct_08.gif',
		'correct_09.gif',
		'correct_10.gif',
		'correct_11.gif',
		'correct_12.gif',
		'correct_13.gif',
		'correct_14.gif',
		'correct_15.gif',
		'correct_16.gif',
		'correct_17.gif',
		'correct_18.gif',
		'correct_19.gif',
		'correct_20.gif'
	],
	incorrect: [
		'icon_024.gif',
		'icon_002.gif',
		'icon_009.gif',
		'icon_033.gif',
		'incorrect_01.gif',
		'incorrect_02.gif',
		'incorrect_03.gif',
		'incorrect_04.gif',
		'incorrect_05.gif',
		'incorrect_06.gif',
		'incorrect_07.gif',
		'incorrect_08.gif',
		'incorrect_09.gif',
		'incorrect_10.gif',
		'incorrect_11.gif',
		'incorrect_12.gif',
		'incorrect_13.gif',
		'incorrect_14.gif',
		'incorrect_15.gif',
		'incorrect_16.gif',
		'incorrect_17.gif',
		'incorrect_18.gif',
		'incorrect_19.gif',
		'incorrect_20.gif',
	]
}

var seenImages = {
	correct: [],
	incorrect: []
}

function imageSelect ( options ) {

	if ( images ) {

		for ( var i = 0; i < images[ options ].length; i++ ) {

			// GENERATE INDEX BETWEEN 0 AND IMAGE ARRAY LENGTH
			var random = Math.floor( Math.random() * images[ options ].length );

			// IF THE IMAGE HASNT BEEN SEEN BEFORE › PUSH SELECTED IMAGE TO ARRAY AND RETURN IMAGE
			if ( seenImages[ options ].indexOf( images[ options ][ random ] ) === -1 ) {

				// PUSH IMAGE URL TO SEEN IMAGES ARRAY
				seenImages[ options ].push( images[ options ][ random ] );

				// RETURN THE IMAGE
				return images[ options ][ random ];

			}

		}

	}

}

// CREATE SCREEN FUNCTION
// ===============================================================================
function Screen ( textElement ) {

	this.el = document.createElement( 'section' );
	this.el.className = 'main-wrapper';

	this.article = document.createElement( 'article' );
	this.el.appendChild( this.article );

	this.textWrapper = document.createElement( 'div' );
	this.text = {};
	this.text.zh = document.createElement( textElement );
	this.text.en = document.createElement( textElement );

	this.choiceList = document.createElement( 'div' );
	this.choiceList.className = 'btn-list';

	this.article.appendChild( this.textWrapper );
	this.textWrapper.appendChild( this.text.zh );
	this.textWrapper.appendChild( this.text.en );
	this.article.appendChild( this.choiceList );

	return this;

}

function progressBar( ) {

	this.el = document.createElement( 'div' );
	this.inner = document.createElement( 'div' );
	this.text = document.createElement( 'span' );
	this.el.className = 'progress-bar';
	this.inner.className = 'progress-bar-inner';
	this.el.appendChild( this.inner );
	this.el.appendChild( this.text );

	return this;

}


// CREATE QUIZ OBJECT
// ===============================================================================
var quiz = {

	data: data,

	currentQuestion: 0,

	correct: [],

	incorrect: [],

	updateBar: function ( bar, question, dataLength ) {

		bar.text.innerHTML = ( parseInt( question ) + 1 ) + ' of ' + dataLength;
		bar.inner.style.width = ( ( parseInt( question ) + 1 ) / dataLength ) * 100 + '%';

		return bar;

	},

	// BUILD QUIZ PAGE FUNCTION
	// ===============================================================================
	init: function (  ) {

		// PREVENT SCROLL ON IPHONES TO DISABLE OVERFLOW JUMP
		document.ontouchmove = function( e ) { e.preventDefault(); }

		// IF THERE ARE ALREADY ANSWERS BUT NO PROGRESS IN LOCALSTORAGE › REMOVE ANSWERS FROM LOCALSTORAGE
		if ( localStorage.getItem( 'answers' ) && !localStorage.getItem( 'progress' ) ) localStorage.removeItem( 'answers' );

		// CREATE PROGRESS BARS
		this.progress = new progressBar();

		this.shadowBar = new progressBar();

		// RUN FIRST NEXT QUESTION CALL ON INIT
		this.setQuestion( this.data, document.getElementById( 'target' ) );

		var intro = document.getElementById( 'intro-screen' );

		if ( intro ) setTimeout( function () { intro.parentNode.removeChild( intro ); }, 1200 );

		return this;

	},


	// NEXT QUESTION FUNCTION
	// ===============================================================================
	setQuestion: function ( data, target ) {

		this.questionScreen = new Screen( 'h2' );

		var $this = this,
			theQuestion = data.questions[ this.currentQuestion ],
			screen = this.questionScreen;

		// APPEND PROGRESS BAR
		if ( screen.article && screen.article.parentNode ) screen.article.parentNode.insertBefore( this.progress.el, screen.article );

		this.updateBar( this.progress, this.currentQuestion, data.questions.length );

		// SET TEXT OF QUESTIONS
		screen.text.zh.innerHTML = theQuestion.question.zh;
		screen.text.en.innerHTML = theQuestion.question.en;

		screen.choice = [
			{ label: 'a', text: {} },
			{ label: 'b', text: {} },
			{ label: 'c', text: {} },
			{ label: 'd', text: {} },
		]

		// SET HTML AND EVENT LISTENER OF CHOICES
		// ===========================================================================
		for ( var i = 0; i < theQuestion.choices.length; i ++ ) {

			var choice = screen.choice[ i ];

			// IF NO CHOICE ELEMENT AT INDEX › CREATE CHOICE ELEMENT
			// =======================================================================
			if ( !choice.el ) {

				choice.el = document.createElement( 'div' );
				choice.el.className = 'choice';
				choice.el.setAttribute( 'data-label', choice.label );

				// CREATE CHOICE BUTTON
				choice.button = document.createElement( 'button' );
				choice.button.className = 'btn';
				choice.button.innerHTML = choice.label;

				// CREATE CHOICE TEXT
				choice.text.wrapper = document.createElement( 'div' );
				choice.text.zh = document.createElement( 'p' );
				choice.text.en = document.createElement( 'p' );

			}

			// APPEND CHOICE ELEMENT TO CHOICES LIST
			if ( !choice.el.parentNode )
				screen.choiceList.appendChild( choice.el );

			if ( !choice.button.parentNode )
				choice.el.appendChild( choice.button );

			if ( !choice.text.wrapper.parentNode ) {

				// APPEND TEXT NODES TO TEXT EL
				choice.el.appendChild( choice.text.wrapper );
				choice.text.wrapper.appendChild( choice.text.zh );
				choice.text.wrapper.appendChild( choice.text.en );

			}

			// SET TEXT OF CHOICE TEXT ELEMENTS
			if ( theQuestion.choices[ i ].zh )
				choice.text.zh.innerHTML = theQuestion.choices[ i ].zh;

			if ( theQuestion.choices[ i ].en )
				choice.text.en.innerHTML = theQuestion.choices[ i ].en;

			// ADD EVENT LISTENER
			// =======================================================================
			choice.el.addEventListener( 'click', function ( e ) {

				this.classList.add( 'clicked' );

				// SET ANSWERS TO EMPTY ARRAY
				var answers = {
					correct: [],
					incorrect: []
				};

				// IF LOCALSTORAGE ALREADY HAS ANSWERS › SET TO CURRENT LOCALSTORAGE DATA SO THERES NO OVERWRITE
				if ( localStorage.getItem( 'answers' ) )
					answers = JSON.parse( localStorage.getItem( 'answers' ) );

				if ( this.getAttribute( 'data-label' ).toLowerCase() === theQuestion.answer.toLowerCase() ) {

					// PUSH CURRENT QUESTION TO CORRECT ARRAY
					answers.correct.push( $this.currentQuestion );

					// RETURN CORRECT RESPONSE
					$this.correctResponse( theQuestion.response );

					window.ga && ga( 'send', 'event', 'answered-question', 'Question ' + $this.currentQuestion, 'Correct: ' + this.getAttribute( 'data-label' ) );

					window.mixpanel && mixpanel.track( 'answered-question', { question: 'Question ' + $this.currentQuestion, label: 'Correct: ' + this.getAttribute( 'data-label' ), } );

				}

				else {

					// PUSH CURRENT QUESTION TO INCORRECT ARRAY
					answers.incorrect.push( $this.currentQuestion );

					// RETURN WRONG RESPONSE
					$this.incorrectResponse( theQuestion.response );

					window.ga && ga( 'send', 'event', 'answered-question', 'Question ' + $this.currentQuestion, 'Incorrect: ' + this.getAttribute( 'data-label' ) );

					window.mixpanel && mixpanel.track( 'answered-question', { question: 'Question ' + $this.currentQuestion, label: 'Incorrect: ' + this.getAttribute( 'data-label' ), } );

				}

				// LOG ANSWERS ARRAY TO LOCALSTORAGE
				localStorage.setItem( 'answers', JSON.stringify( answers ) );

			});

		}

		this.currentQuestion = parseInt( this.currentQuestion );
		this.currentQuestion += 1;

		// IF THERES A RESPONSE SCREEN OPEN › CLOSE RESPONSE SCEEN
		if ( this.response && this.response.el.parentNode )
			this.closeScreen( $this.response, screen.el );

		// ELSE › APPEND TO BODY
		else {

			document.getElementById( 'target' ).appendChild( screen.el );

			// ADD OPEN CLASS FOR ANIMATION
			setTimeout( function() { screen.el.classList.add( 'open' ); }, 50 );

		}

		return this;

	},


	// RESPONSE SCREEN FUNCTION
	// ===============================================================================
	responseScreen: function ( target ) {

		// LOG CURRENT QUESTION TO LOCALSTORAGE
		if ( localStorage ) localStorage.setItem( 'progress', JSON.stringify( this.currentQuestion ) );

		var $this = this;

		this.response = new Screen( 'h2' );

		// APPEND PROGRESS BAR
		this.response.article.parentNode.insertBefore( this.progress.el, this.response.article );

		// ADD AND APPEND IMAGE
		if ( !this.response.image )
			this.response.image = document.createElement( 'img' );

		if ( !this.response.parentNode && this.response.textWrapper.parentNode )
			this.response.textWrapper.parentNode.insertBefore( this.response.image, this.response.textWrapper );

		// ADD NEXT BUTTON
		// ============================================================================
		this.response.button = document.createElement( 'button' );
		this.response.button.className = 'btn btn-red';
		this.response.choiceList.appendChild( this.response.button );

		// IF NOT LAST QUESTION › SET TEXT OF BUTTON TO REFLECT THAT
		if ( this.currentQuestion < this.data.questions.length )
			this.response.button.innerHTML = 'Next Question / 下一题'

		// ELSE › SET BUTTON TEXT TO FINISH QUIZ
		else this.response.button.innerHTML = 'Finish Quiz! / 结束测试！';

		// ADD CLICK EVENT TO NEXT QUESTION BUTTON
		this.response.button.addEventListener( 'click', function ( ) {

			// IF NOT LAST QUESTION › LOAD NEXT QUESTION ON CLICK
			if ( $this.currentQuestion < $this.data.questions.length ) {

				window.ga && ga( 'send', 'event', 'next-question', 'Question ' + $this.currentQuestion, 'Question ' + $this.currentQuestion );

				window.mixpanel && mixpanel.track( 'next-question', { question: 'Question ' + $this.currentQuestion, label: null, } );

				$this.setQuestion( $this.data, document.getElementById( 'target' ) );

			}

			// ELSE › RUN FINISH QUIZ FUNCTION WITH DATA FROM LOCALSTORAGE
			else {

				// STORE COMPLETED ITEM TO LOCALSTORAGE
				localStorage.setItem( 'completed', JSON.stringify( 'true' ) );

				var results = JSON.parse( localStorage.getItem( 'answers' ) );

				window.ga && ga( 'send', 'event', 'finish-quiz', 'Finish Quiz', results.correct.length.toString() + '/' + ( results.correct.length + results.incorrect.length ).toString() );

				window.mixpanel && mixpanel.track( 'finish-quiz', { question: 'Finish Quiz', label: results.correct.length.toString() + '/' + ( results.correct.length + results.incorrect.length ).toString(), } );

				$this.finishQuiz( results.correct );

			}

		} );

		// CLOSE QUESTION SCREEN AND APPEND RESPONSE SCREEN
		this.closeScreen( this.questionScreen, this.response.el );

		return this;

	},

	closeScreen: function ( theScreenObject, replacement, theScreenElement ) {

		var $this = this;

		// APPEND SHADOW BAR TO SCREEN
		if ( theScreenObject && theScreenObject.article ) theScreenObject.article.parentNode.insertBefore( this.shadowBar.el, theScreenObject.article );
		if ( this.shadowBar ) this.updateBar( this.shadowBar, this.currentQuestion - 1, data.questions.length );

		// APPEND NEW SCREEN TO BODY
		document.getElementById( 'target' ).appendChild( replacement );

		// ADD OPEN CLASS FOR ANIMATION
		setTimeout( function() { replacement.classList.add( 'open' ); }, 50 );

		// CLOSE SCREEN ON ANIMATION FINISH
		setTimeout( function () {

			if ( theScreenObject && theScreenObject.el ) {

				theScreenObject.el.parentNode.removeChild( theScreenObject.el );

			} else if ( theScreenElement ) {

				theScreenElement.parentNode.removeChild( theScreenElement );

			}

		}, 1250 );

	},

	// CORRECT ANSWER FUNCTION
	// ===============================================================================
	correctResponse: function ( response ) {

		this.responseScreen( document.getElementById( 'target' ) );

		var image = imageSelect( 'correct' );

		this.response.image.src = './images/' + image;

		this.response.text.zh.innerHTML = '<strong class="correct">是啊！</strong>&nbsp;' + response.zh;
		this.response.text.en.innerHTML = '<strong class="correct">Correct!</strong>&nbsp;' + response.en;

		return this;

	},


	// WRONG ANSWER FUNCTION
	// ===============================================================================
	incorrectResponse: function ( response ) {

		this.responseScreen( document.getElementById( 'target' ) );

		var image = imageSelect( 'incorrect' );

		this.response.image.src = './images/' + image;

		this.response.text.zh.innerHTML = '<strong class="incorrect">不是！</strong>&nbsp;' + response.zh;
		this.response.text.en.innerHTML = '<strong class="incorrect">Wrong!</strong>&nbsp;' + response.en;

		return this;

	},

	// DISPLAY RESULTS PAGE FUNCTION
	// ===============================================================================
	finishQuiz: function ( correctAnswers ) {

		var $this = this;

		var resultsPage = new Screen( 'h2' );
		resultsPage.el.id = 'splash-screen';
		resultsPage.el.classList.add( 'final-screen' );

		// ADD AND APPEND SHARE CTA
		resultsPage.shareCTA = document.createElement( 'small' );
		resultsPage.shareCTA.className = 'share-wechat';
		resultsPage.shareCTA.innerHTML = '分享该测试!<br>Share the quiz!';
		resultsPage.article.insertBefore( resultsPage.shareCTA, resultsPage.textWrapper );

		// ADD AND APPEND ARROW
		resultsPage.arrow = document.createElement( 'img' );
		resultsPage.arrow.className = 'arrow share-wechat';
		resultsPage.arrow.src = './images/assets/arrow.png';
		resultsPage.article.insertBefore( resultsPage.arrow, resultsPage.choiceList );

		resultsPage.textWrapper.classList.add( 'vertical-center' );

		// ADD AND APPEND IMAGE
		resultsPage.image = document.createElement( 'img' );
		resultsPage.image.className = 'normal-image character';
		resultsPage.textWrapper.insertBefore( resultsPage.image, resultsPage.text.zh );

		var moreInformation = document.createElement( 'div' );

		resultsPage.article.appendChild( moreInformation );

		resultsPage.followCTA = document.createElement( 'small' );
		resultsPage.followCTA.innerHTML = '科握制造。了解更多<br>Produced by KAWO. Learn more'
		moreInformation.appendChild( resultsPage.followCTA );

		resultsPage.logo = document.createElement( 'div' );
		resultsPage.logo.className = 'logo logo-icon';
		moreInformation.appendChild( resultsPage.logo );

		// ON CLICK OF MORE INFORMATION › OPEN INFORMATION PAGE
		moreInformation.addEventListener( 'click', function() {

			// LOG RESULTS PAGE TO THIS TO BE ACCESSIBLE VIA CLOSE FUNCTION
			$this.resultsPage = resultsPage;

			$this.learnMore();

			window.ga && ga( 'send', 'event', 'learn-more', 'Learn More', 'Learn More' );

			window.mixpanel && mixpanel.track( 'learn-more', { question: 'Learn More', label: null, } );


		});


		// ALTER PAGE ACCORDING TO SCORE
		// ============================================================================

		// DONT LET BE MROE THAN 100% THROUGH LOCAL STORAGE HACKS
		if ( correctAnswers.length > 20 ) var correct = '20';
		else var correct = correctAnswers.length.toString();

		var scoreEn = correct + '/' + this.data.questions.length.toString(),
			scoreZh = this.data.questions.length.toString() + '题中的' + correct;

		// IF THEY SCORED 80% OR HIGHER › DISPLAY DIGITAL MASTER PAGE
		if ( correctAnswers.length / this.data.questions.length >= 0.8 ) {

			var levelImage = 'shifuKAWO.png',
				levelMessageEn = '. <br>Congratulations! You\'re a digital shīfù!',
				levelMessageZh = '题，恭喜你得到了‘数码师傅’的称号！',
				titleMessage = '我是一个数码师傅。快来参加问答！I\'m a digital shīfù, are you? Take the quiz!';

		}

		// IF THEY SCORED BETWEEN 80% AND 30% › DISPLAY DIGITAL UNCLE PAGE
		else if ( correctAnswers.length / this.data.questions.length >= 0.35 ) {

			var levelImage = 'uncleKAWO.png',
				levelMessageEn = '. <br>Not bad, you\'re a digital dàshū!',
				levelMessageZh = '题，你可以得到‘数码大叔’的称号，看起来还不错嘛！',
				titleMessage = '我是一个数码大叔。 快来参加问答！I\'m a digital dàshū. Take the quiz!';

		}

		// ELSE › DISPLAY DIGITAL BABY PAGE
		else {

			var levelImage = 'babyKAWO.png',
				levelMessageEn = ' and are a digital bǎobǎo. Time to study!',
				levelMessageZh = '题，看来你只能得到‘数码宝宝’的称号，还要继续努力啊！',
				titleMessage = '我是一个数码宝宝。快来参加问答！I\'m a digital bǎobǎo. Take the quiz!';

		}

		// SET INNER HTML OF TEXT
		resultsPage.text.zh.innerHTML = '你答对了' + scoreZh + levelMessageZh;
		resultsPage.text.en.innerHTML = 'You scored ' + scoreEn + levelMessageEn;

		// SET CHARACTER IMAGE URL
		resultsPage.image.src = './images/characters/' + levelImage;

		// SET NEW TITLE FOR SHARING
		var title = document.querySelectorAll( 'title' )[ 0 ];
		if ( title ) title.innerHTML = titleMessage;

		// CLOSE RESPONSE SCREEN AND APPEND RESULTS SCREEN
		if ( this.responseScreen )
			this.closeScreen( this.responseScreen, resultsPage.el );

		else
			document.getElementById( 'target' ).appendChild( resultsPage.el );

		// IF ON DESKTOP › LOAD FACEBOOK AND TWITTER SHARE ICONS
		if ( window.innerWidth > 641 ) {

			// FACEBOOK SHARE SCRIPT
			(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0];if (d.getElementById(id)) return;js = d.createElement(s); js.id = id;js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));

			// TWITTER SHARE SCRIPT
			!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');

			var shareList = document.createElement( 'ul' ),
				facebookShare = document.createElement( 'li' ),
				twitterShare = document.createElement( 'li' ),
				facebookShareInner = document.createElement( 'div' ),
				twitterShareInner = document.createElement( 'a' ),
				shareTarget = document.getElementById( 'share-target' );

			shareTarget.style.padding = '10px';

			facebookShareInner.className = 'fb-share-button';
			facebookShareInner.setAttribute( 'data-layout', 'button_count' );

			twitterShareInner.className = 'twitter-share-button';
			twitterShareInner.href = 'https://twitter.com/share';
			twitterShareInner.setAttribute( 'data-via', 'kawo' );
			twitterShareInner.innerHTML = 'Tweet';

			shareList.appendChild( facebookShare );
			shareList.appendChild( twitterShare );
			facebookShare.appendChild( facebookShareInner );
			twitterShare.appendChild( twitterShareInner );

			// APPEND SHARE BUTTONS TO SHARE TARGET
			shareTarget.appendChild( shareList );

		}

		return this;

	},

	learnMore: function(  ) {

		var learnMore = new Screen( 'h2' );
		learnMore.el.id = 'splash-screen';
		learnMore.el.classList.add( 'learn-more-screen' );

		learnMore.logo = document.createElement( 'div' );
		learnMore.logo.className = 'logo';
		learnMore.textWrapper.parentNode.insertBefore( learnMore.logo, learnMore.textWrapper );

		learnMore.text.zh.innerHTML = '从初稿，规划，再到发布，分析数据，KAWO帮助您的品牌在中国大放异彩。<br><a href="http://kawo.com/cn.html">在科握官方网站了解更多</a>';
		learnMore.text.en.innerHTML = 'KAWO is an enterprise Weibo & WeChat management tool helping organizations take control of their brand in China. <br>Learn more at <a href="http://kawo.com">KAWO.com</a>';

		// ADD FOLLOW INFORMATION TO CHOICE LIST
		learnMore.followCTA = document.createElement( 'small' );
		learnMore.followCTA.innerHTML = '最新详情请可以关注KAWO的微信。<br>Follow us on WeChat.'
		learnMore.choiceList.appendChild( learnMore.followCTA );

		// ADD QR CODE
		learnMore.qrCode = document.createElement( 'img' );
		learnMore.qrCode.className = 'normal-image';
		learnMore.qrCode.src = './images/assets/qr-code.jpg';
		learnMore.article.appendChild( learnMore.qrCode );

		// CLOSE RESPONSE SCREEN AND APPEND RESULTS SCREEN
		if ( this.resultsPage ) this.closeScreen( this.resultsPage.el, learnMore.el );

		else {

			document.body.appendChild( learnMore.el );

			setTimeot( function (  ) {

				learnMore.el.classList.add( 'open' );

				if ( learnMore.el.getBoundingClientRect().height <= 568 ) learnMore.el.classList.add( 'smaller-screen' );

			}, 50 );

		}

		// SET NEW TITLE
		var title = document.querySelectorAll( 'title' )[ 0 ];
		if ( title ) title.innerHTML = 'KAWO Quiz';

	},

}

// ON LOAD › CREATE SPLASH SCREEN OR SET QUESTIONS ACCORINDG TO LOCAL STORAGE
// ===============================================================================
window.onload = function () {

	// IF QUIZ NOT STARTED YET › SET SPLASH SCREEN
	// ============================================================================
	if ( !localStorage.getItem( 'progress' ) && !localStorage.getItem( 'completed' ) ) {

		var splash = new Screen( 'h2' );

		splash.el.id = 'splash-screen';
		splash.el.classList.add( 'landing-screen' );

		splash.el.classList.add( 'open' );

		splash.textWrapper.className = 'splash-text-wrapper';
		splash.text.zh.innerHTML = '你是数码<br>师傅吗?';
		splash.text.en.innerHTML = 'Are you a <br>digital shīfù?';
		splash.text.en.style.textTransform = 'uppercase';

		// ADD NEXT BUTTON
		splash.button = document.createElement( 'button' );
		splash.button.className = 'btn btn-white';
		splash.choiceList.appendChild( splash.button );

		// ADD TEXT TO BUTTON
		splash.button.innerHTML = '<span class="btn-zh">开始测试</span>Get Started'

		splash.logo = document.createElement( 'div' );
		splash.logo.className = 'logo logo-icon';
		splash.choiceList.appendChild( splash.logo );

		document.getElementById( 'target' ).appendChild( splash.el );

		// IF NOT COMPLETED AND QUIZ WILL INIT › PRELOAD SOME IMAGES
		// ===============================================================================
		var preloaded = [];

		// PRELOAD THE FIRST 10 CORRECT / INCORRECT IMAGES
		// ===============================================================================
		for ( var i = 0; i < 20; i++ ) {

			// IF IN CORRECT LENGTH › PRELOAD CORRECT IMAGES
			if ( i < 11 ) {

				preloaded[ i ] = new Image()
				preloaded[ i ].src = './images/' + images.correct[ i ];

			}

			// ELSE › PRELOAD INCORRECT IMAGES
			else {

				preloaded[ i ] = new Image()
				preloaded[ i ].src = './images/' + images.incorrect[ i - 10 ];

			}

		}

		// START QUIZ
		// ===============================================================================
		splash.button.addEventListener( 'click', function ( ) {

			window.ga && ga( 'send', 'event', 'get-started', 'click', 'Opened introduction page' );

			window.mixpanel && mixpanel.track( 'get-started' );

			var intro = new Screen( 'h2' );

			intro.el.id = 'intro-screen';

			// ADD AND APPEND IMAGE
			intro.image = document.createElement( 'img' );
			intro.image.src = './images/icon_019.gif';

			intro.textWrapper.parentNode.insertBefore( intro.image, intro.textWrapper );

			intro.text.zh.innerHTML = '这个测试将会考验你对2015年中国数码行业的了解。你是一个数码师傅么？点进来看看吧。';
			intro.text.en.innerHTML = 'This quiz tests your knowledge of the Chinese digital industry in 2015. Are you a digital shīfù?';

			// ADD NEXT BUTTON
			intro.button = document.createElement( 'button' );
			intro.button.className = 'btn btn-red';
			intro.choiceList.appendChild( intro.button );

			// ADD TEXT TO BUTTON
			intro.button.innerHTML = 'Start Quiz / 开始测试'

			intro.logo = document.createElement( 'div' );
			intro.logo.className = 'logo logo-icon';
			intro.choiceList.appendChild( intro.logo );

			// INITIATE QUIZ ON BUTTON CLICK
			intro.button.addEventListener( 'click', function ( ) {

				window.ga && ga( 'send', 'event', 'quiz-started', 'click', 'Quiz started' );

				window.mixpanel && mixpanel.track( 'quiz-started' );

				quiz.init();

			} );

			// CLOSE SPLASH SCREEN
			quiz.closeScreen( null, intro.el, splash.el );

		} );

	}


	// IF PROGRESS MADE IN LOCALSTORAGE BUT QUIZ NOT COMPLETED › JUMP TO LAST QUESTION
	// ============================================================================
	else if ( localStorage.getItem( 'progress' ) && !localStorage.getItem( 'completed' ) ) {

		quiz.currentQuestion = parseInt( localStorage.getItem( 'progress' ) );

		window.ga && ga( 'send', 'event', 'returned-to-quiz', 'Pageview', 'Returned on question: ' + localStorage.getItem( "progress" ) );

		window.mixpanel && mixpanel.track( 'returned-to-quiz', { question: localStorage.getItem( "progress" ), label: null, } );

		quiz.init();

	}

	// IF COMPLETED AND ANSWERS STORED › GENERATE COMPLETION PAGE
	// ============================================================================
	else if ( localStorage.getItem( 'completed' ) && localStorage.getItem( 'answers' ) ) {

		quiz.finishQuiz( JSON.parse( localStorage.getItem( 'answers' ) ).correct );

	}

	// IF ANY UNFORSEEN ROUTE TAKEN › JUST START THE QUIZ
	// ============================================================================
	else {

		localStorage.clear();
		quiz.init();

	}

}